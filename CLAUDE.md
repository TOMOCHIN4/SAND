# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## プロジェクト概要

このリポジトリは中学受験対策を中心とした教育コンテンツプロジェクトです。主に2つの要素で構成されています：

1. **教材資料** (`教材資料/`) - 各教科のマークダウン形式学習資料（整理統合済み）
2. **AIポッドキャスト生成システム** (`自作ポッドキャスト/`) - Google Gemini APIを使用した高度な音声コンテンツ制作システム

## アーキテクチャ

### AIポッドキャストシステム
Google Gemini Text-to-Speech APIを使用して、マルチスピーカー対話による教育・エンターテインメントポッドキャストを生成：

- **フレームワーク**: `google-genai`ライブラリを使用したPythonベース
- **音声出力**: WAV形式（16-bit PCM、可変サンプリングレート）
- **キャラクターシステム**: 一貫した音声個性を持つマルチスピーカー対話
- **コンテンツタイプ**: 教育系（理科/社会/算数/国語）とエンターテインメント系（サンドウィッチマン風コメディ）

### 主要技術コンポーネント
- **音声モデル**: 30種類以上の音声（autonoe、callirrhoe、leda等）
- **生成パイプライン**: Markdownプロンプト → Gemini TTS API → WAV音声 → MP3変換（オプション）
- **キャラクタープロファイル**: 一貫した対話のための`system_instruction.txt`での定義
- **コンテンツ管理**: スクリプトと音声の両方を保持する構造化出力

## よく使うコマンド

### セットアップと依存関係
```bash
# 必要パッケージのインストール
pip install -r requirements.txt

# APIキーの設定（共通リソースで一元管理）
echo "YOUR_GEMINI_API_KEY" > 自作ポッドキャスト/共通リソース/音声化Doc/gemini_api_key.txt
```

### 音声生成

#### 教育ポッドキャスト（理科・社会等）
```bash
# 基本的な生成
python generate_podcast.py --prompt "制作物/プロンプト/[ファイル名].md"

# 5分版で特定の音声を指定
python generate_podcast.py --prompt "prompt.md" --duration 5 --voice1 autonoe --voice2 callirrhoe

# 高品質Pro版
python generate_podcast.py --prompt "prompt.md" --model gemini-2.5-pro-preview-tts

# 利用可能音声モデル一覧
python generate_podcast.py --list-voices
```

#### エンターテインメントコンテンツ（サンドウィッチマン風コメディ）
```bash
# コメディ対話の生成
python サンドウィッチマン風/generate_sandwich_audio.py

# 最高品質版
python サンドウィッチマン風/generate_acoustic_perfect.py
```

### プロジェクト管理
```bash
# 新規教科エリアの作成
python setup_podcast_project.py ./新規プロジェクト名

# WAVからMP3への変換
python convert_to_mp3.py

# 複数エピソードの結合
python combine_episodes.py
```

## プロジェクト構造

整理後の新しいディレクトリ構造：
```
あおいお勉強/
├── 教材資料/                     # 統合された学習教材
│   ├── 全般/                     # 国語・算数・理科の汎用教材
│   ├── 理科/                     # 理科専用参考資料
│   └── 社会/                     # 社会専用参考資料（重複削除済み）
├── 自作ポッドキャスト/
│   ├── 共通リソース/             # 統合されたリソース
│   │   └── 音声化Doc/            # APIキー・技術ドキュメント
│   │       ├── gemini_api_key.txt
│   │       ├── Get_started_TTS.ipynb
│   │       └── sample_*.txt
│   ├── サンドウィッチマン風/      # エンターテインメント系（最新版のみ）
│   │   ├── generate_acoustic_perfect.py
│   │   ├── generate_ultimate_audio.py
│   │   └── 制作物/
│   └── [各教科]/                 # 教科別ポッドキャスト
│       ├── 音声化Doc/
│       │   └── system_instruction.txt  # 教科特有設定のみ
│       ├── 制作物/
│       │   ├── プロンプト/
│       │   └── 音源/
│       └── generate_podcast.py
└── CLAUDE.md                      # 統合ガイドライン
```

## キャラクターシステム

### 教育コンテンツ
- **ゆうこ先生**: 金沢出身40代女性教師、優しい金沢弁、音声：`autonoe`
- **あおいちゃん**: 大阪出身11歳女児、ソフトな関西弁、音声：`callirrhoe`または`leda`

### コメディコンテンツ（サンドウィッチマン風）
- **富澤**: ボケ役、淡々とした話し方
- **伊達**: ツッコミ役、エネルギッシュな反応

## 重要なガイドライン

### ファイル管理
- **`制作物/`ディレクトリ内のファイルは絶対に上書き禁止** - 常に新しい番号付きファイルを作成
- **スクリプトと音声の両方を保存** 各生成ごとに
- **APIキーの一元管理** `自作ポッドキャスト/共通リソース/音声化Doc/gemini_api_key.txt`で統一管理
- **共通リソースの活用** 技術ドキュメントは共通リソースフォルダから参照

### コンテンツ作成ベストプラクティス
- **固有名詞は必ずカタカナ表記** 対話スクリプトでの正確な発音のため
- **時間計算用文字数**: 実際の対話テキストのみカウント、ヘッダー・フォーマットは除外
- **5分コンテンツ**: 対話部分で1,800-2,200文字を目標
- **安全第一**: 理科実験では安全指示を必ず含める

### 音声選択ガイドライン
- **教師・大人**: `autonoe`使用（落ち着いた成熟した女性の声）
- **子供**: `callirrhoe`または`leda`使用（高音、年齢に適した声）
- **コメディ**: より良いコメディ効果のため対照的な音声で実験

## 推奨設定

### 標準教育コンテンツ
```python
model = "gemini-2.5-flash-preview-tts"
temperature = 0.9
voice1 = "autonoe"  # 先生
voice2 = "callirrhoe"  # 生徒
```

### 高品質制作
```python
model = "gemini-2.5-pro-preview-tts"  # 時間はかかるが高品質
temperature = 0.8
```

## 教科別特記事項

### 理科
- 実験と体験学習を重視
- 全ての実験に安全警告を含める
- 日常例を使って科学概念を説明

### 社会
- 歴史的物語と地理的理解に焦点
- 文化的背景と実世界への応用を含める
- キャラクター対話は自然で魅力的に

### コメディコンテンツ
- サンドウィッチマン特有のユーモアスタイルを維持
- 誤解と言葉遊びを効果的に使用
- コメディタイミングを緊密で自然に保つ

## 開発ワークフロー

1. **コンテンツ計画**: 各エリアの教科別テンプレートを使用
2. **スクリプト作成**: キャラクターガイドラインに従ってマークダウン形式で対話を記述
3. **音声生成**: 適切な生成スクリプトと最適設定を使用
4. **品質チェック**: 音声品質とキャラクター一貫性を確認
5. **アーカイブ**: スクリプトと音声の両方を`制作物/`ディレクトリに保存

## トラブルシューティング

- **APIエラー**: `自作ポッドキャスト/共通リソース/音声化Doc/gemini_api_key.txt`内のAPIキーを確認
- **音声品質**: `AVAILABLE_VOICES`リストから異なる音声モデルを試行
- **長い生成時間**: より高速な結果のためproではなくflashモデルを使用
- **ファイル競合**: 上書きではなく常に新しい番号付きファイルを作成
- **共通リソース参照**: 技術ドキュメントは`共通リソース/音声化Doc/`から参照

## 整理完了事項

このディレクトリは2024年12月に大幅な整理整頓を実施済みです：
- **削除ファイル数**: 39ファイル（古いバージョン、重複ファイル）
- **統合実施**: APIキー、音声化Doc、教材資料の統合
- **構造最適化**: 共通リソース化により保守性向上
- **重複解消**: 約4.2MBの重複教材を整理統合