# 理科ポッドキャスト音声生成 ベストプラクティス

## 成功要因の分析

### 1. 台本の構造と分量
**成功パターン**:
- 対話部分（Speaker 1から---まで）: 1,800-2,200文字
- 5分版の場合: 1分あたり360-440文字の計算で適切な分量
- 発話の区切り: 3-5文程度で読みやすく

**失敗パターン**:
- 初期の台本: 73単語（約150文字）で圧倒的に不足
- 対話部分が短すぎて音声時間が30秒程度になってしまう

### 2. 音声設定の最適化
**成功設定**:
```python
# ゆうこ先生（40代女性教師）
voice1 = "autonoe"  # 落ち着いた大人の女性

# あおいちゃん（11歳女児）
voice2 = "leda"     # 最高音・子供らしい声
```

**改善履歴**:
- callirrhoe → leda に変更（より高音で子供らしい声）

### 3. モデル選択
**推奨**:
- **gemini-2.5-pro-preview-tts**: 最高品質（時間はかかるがクオリティ重視）
- **gemini-2.5-flash-preview-tts**: 高速（通常用途）

### 4. タイムアウト対策
**成功要因**:
- ストリーミング処理（generate_content_stream）の活用
- 600秒（10分）のタイムアウト設定
- 5分程度の台本での安定生成

## 安定生成のための必須チェックリスト

### 台本作成時
- [ ] 対話部分が1,800-2,200文字（5分版）
- [ ] Speaker 1とSpeaker 2の明確な区別
- [ ] ---マーカーで対話部分の終了を明示
- [ ] 理科用語のカタカナ表記を適切に

### 音声生成実行時
- [ ] APIキーファイルの存在確認（音声化Doc/gemini_api_key.txt）
- [ ] system_instruction.txtの存在確認
- [ ] ネットワーク環境が安定していることを確認
- [ ] 十分な処理時間の確保（Pro版は5-10分）

### コマンド例
```bash
# 基本的な5分版生成（Flash版・高速）
python generate_podcast.py --prompt "制作物/台本/[テーマ].md" --duration 5

# 最高品質版生成（Pro版・時間がかかる）
python generate_podcast.py --prompt "制作物/台本/[テーマ].md" --model gemini-2.5-pro-preview-tts --duration 5

# 音声調整（あおいちゃんをより高音に）
python generate_podcast.py --prompt "制作物/台本/[テーマ].md" --voice2 leda --duration 5
```

## 品質管理

### 音声ファイルの品質指標
- **ファイルサイズ**: 5分版で約15-20MB（16bit WAV）
- **時間**: 指定時間±15秒以内
- **キャラクター**: 明確に区別できる2つの声質

### よくある問題と対処法

**問題**: 音声が短すぎる
- **原因**: 台本の対話部分が不足
- **対処**: 1,800文字以上の対話を作成

**問題**: タイムアウトエラー
- **原因**: ネットワーク不安定・台本が長すぎる
- **対処**: 5分版から開始、Pro版は時間に余裕を持つ

**問題**: キャラクターの声が似ている
- **原因**: 音声モデルの選択ミス
- **対処**: autonoe（大人女性）+ leda（子供高音）の組み合わせ

## 現在の最適設定（2025年6月版）

### デフォルト設定
```python
DEFAULT_MODEL = "gemini-2.5-flash-preview-tts"
DEFAULT_TEMPERATURE = 0.9
DEFAULT_VOICE_1 = "autonoe"    # ゆうこ先生
DEFAULT_VOICE_2 = "leda"       # あおいちゃん（最高音）
```

### 推奨ワークフロー
1. **台本作成**: 理科プロンプトテンプレート_統合版.mdを参考に
2. **内容確認**: 対話部分の文字数をチェック
3. **テスト生成**: Flash版で動作確認
4. **本生成**: Pro版で最終品質版を作成
5. **品質確認**: ファイルサイズと再生時間を確認

## 成功事例

### 音の計算問題のコツ_完全5分版
- **台本**: 2,000文字の充実した対話
- **生成**: gemini-2.5-pro-preview-tts
- **結果**: 18.6MB、約5分の高品質音声
- **キャラクター**: 明確に区別できる teacher-student 関係

この設定と手順で、理科ポッドキャストの安定した高品質生成が可能です。

## 今後の改善案
- 他の理科分野（物理・化学・生物・地学）での動作確認
- 10分版での長時間生成テスト
- 新しい音声モデルのテスト（API更新時）